<div class="bg-override meta-snapshot container-fluid">
    
    <div class="container wrapper-none heading">
        <div class="snapTitle">
            <h1>THE META SNAPSHOT: #{{snapshot.snapNum}}</h1>
            <h3>{{snapshot.title}}</h3>
            
        </div>
        <div class="snapshot-votes pull-right clearfix"> 
                
            <span class="snapVoteWrap">
                <div class="vote-count vote-large m-l-sm pull-right">
                    {{snapshot.votesCount}}
                </div>
                <a ng-if="!voted" class="btn-vote-up vote-large" ng-click="voteSnapshot()"><p><i class="fa fa-thumbs-up"></i></p></a>
            </span>

        </div>
        <img class="sideBorders img-responsive head-img" src="../../img/meta-snapshot/generic-meta.jpg" />
    </div>
    <div class="container meta-container sideBorders">
        <div class="m-t-md">
            
            <div class="row no-pad clearfix">

                <div class="col-xs-12 col-lg-push-8 col-lg-4 rightSide clearfix m-b-md">
                    <div class="sideTier" ng-repeat="tier in deckTiers">
                        <button ng-click="show[tier.tier] = !show[tier.tier]" class="btn-block sideTier" role="button" data-toggle="collapse" href="#collapseSideTier{{tier.tier}}" aria-expanded="false" aria-controls="collapseSideTier{{tier.tier}}">
                            <div class="sideTierHead">
                                <div class="inner">
                                    <h3 class="pull-left m-b-none">Tier {{tier.tier}}</h3>

                                    <i class="fa" ng-class="{ 'fa-plus' : !show[tier.tier], 'fa-minus' : show[tier.tier] }"></i>
                                </div>
                            </div>
                        </button>
                        <div class="sideTierBody collapse" id="collapseSideTier{{tier.tier}}">
                            <div class="sideTierDeck deck-portrait-{{deck.deck.playerClass}}-sm" ng-repeat="deck in tier.decks">
                                <a href="#{{deck.rank[0]}}" ng-click="findDeck(tier.tier, deck.rank[0])">
                                    <div class="sideTierDeckRank pull-left clearfix">
                                        <h4>{{deck.ranks[0]}}</h4>
                                    </div>
                                    <div class="sideTierDeckName pull-left clearfix">
                                        <h4 class="ell">{{deck.name}}</h4>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xs-12 col-lg-pull-4 col-lg-8 leftSide m-b-md">
                    <div class="content intro m-b-md">
                        <div class="inner wrapper-md">
                            <div class="clearfix">
                                <h2>
                                    INTRODUCTION
                                </h2>
                                <hr class="hr pull-left m-b-md m-t-xs">
                            </div>
                            <p>{{snapshot.content.intro}}</p>
                        </div>
                    </div>

                    <div class="content thoughts">
                        <div class="inner wrapper-md">
                            <div class="clearfix">
                                <h2>
                                    THOUGHTS AND OBSERVATIONS
                                </h2>
                                <hr class="hr pull-left m-b-md m-t-xs">
                            </div>
                            <p>{{snapshot.content.thoughts}}</p>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <div class="row no-pad m-b-md">
                <div class="col-xs-12">
                    <div class="trends-wrapper pos-rl">
                        <div class="inner">
                            <h2>DECK TRENDS</h2>
                            <hr class="hr m-b-md m-t-xs">

                            <svg class="trends m-b-md" style="overflow: visible">
                                <svg width="90%" height="100%" x="5%" y="5%" style="overflow: visible">
                                    <text transform="rotate(270, 0, 210)" x="0" y="200" fill="white" text-anchor="end">Rank</text>
                                    <text x="50%" y="100%" fill="white" text-anchor="middle">Meta Snapshot #</text>
                                    <g ng-repeat="num in tierRange[currentTier] track by $index">
                                        
                                        <text ng-if="(tierRange[currentTier].length > 20) ? ($index%2 == 0) : true;" height="15" x="4%" ng-attr-y="{{getPositionY(currentTier, $index, 410, 20) + 4}}" fill="white" text-anchor="end">{{num}}</text>                                
                                        

                                        <line ng-attr-x1="{{getPositionX(0, 10)}}%" ng-attr-y1="{{getPositionY(currentTier, $index, 410, 20)}}" ng-attr-x2="{{getPositionX(12, 10)}}%"  ng-attr-y2="{{getPositionY(currentTier, $index, 410, 20)}}" style="stroke:rgba(255,255,255,.4)"/>
                                    </g>

                                    <line ng-attr-x1="{{getPositionX($index, 10)}}%" y1="0" ng-attr-x2="{{getPositionX($index, 10)}}%" y2="410" style="stroke:rgba(255,255,255,.4)" ng-repeat="moment in snapshotTimeline() track by $index"/>
                                    <line x1="5%" y1="410" x2="95%" y2="410" style="stroke:rgba(255,255,255,.4)"/>
                                    <text height="15" ng-attr-x="{{getPositionX($index, 10)}}%" y="425" fill="white" text-anchor="middle" ng-class="{ 'hidden-xs' : $index%2 == 1 }" ng-repeat="moment in snapshotTimeline() track by $index">{{moment}}</text>

                                    <g ng-repeat="deck in getTier(currentTier).decks track by $index" class="deck" ng-class="{ 'not-selected': hasDeckSelected() && currentDeck != deck.rank.current }">
                                        <g ng-repeat="rank in deck.rank.all track by $index" ng-if="rank > 0">
                                            <circle class="dot-{{deck.deck.playerClass}}" ng-attr-cx="{{getPositionX($index, 10)}}%" ng-attr-cy="{{getPositionY(currentTier, getRankIndex(currentTier, rank), 410, 20)}}" r="5" stroke-width="2" fill="transparent" ng-if="rank > 0"/>
                                            <line class="dot-{{deck.deck.playerClass}}" ng-attr-x1="{{getPositionX($index, 10)}}%" ng-attr-y1="{{getPositionY(currentTier, getRankIndex(currentTier, rank), 410, 20)}}" ng-attr-x2="{{getPositionX($index + 1, 10)}}%" ng-attr-y2="{{getPositionY(currentTier, getRankIndex(currentTier, getNextRank(deck, $index)), 410, 20)}}" stroke-width="2" ng-if="hasNextRank(deck, $index)" />
                                        </g>
                                    </g>
                                    
                                </svg>
                                
                            </svg>
                            <ul class="snapshot-trends-tiers m-t-lg">
                                <li ng-repeat="tier in deckTiers"><a href="#" ng-class="{ 'active': tier.tier == currentTier }" ng-click="setCurrentTier(tier.tier)">TIER {{tier.tier}}</a></li>
                            </ul>

                            <div class="row snapshot-trends-keys">
                                <div class="col-xs-12 col-sm-6 col-md-4 col-lg-3" ng-repeat="deck in getTier(currentTier).decks track by $index"><a href="#" ng-class="{ 'active': deck.rank[0] == currentDeck }" ng-click="toggleCurrentDeck(deck.rank[0])"><span class="trends-key {{deck.deck.playerClass}} m-r-sm"></span>{{deck.name}}</a></div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- TIERS -->
            <div class="tiers m-b-md">
                <div id="tier{{tier.tier}}" ng-repeat="tier in deckTiers" class="tier clearfix">
                    <button class="btn btn-block btn-tier-collapse" role="button" data-toggle="collapse" href="#collapseTier{{tier.tier}}" aria-expanded="false" aria-controls="collapseTier{{tier.tier}}">
                        <div class="tier-heading clearfix">
                            <h2 class="pull-left">TIER {{tier.tier}}</h2>
                        </div>
                    </button>

                    <div class="tier-body collapse" id="collapseTier{{tier.tier}}">
                        <div id="deck{{deck.rank[0]}}" ng-repeat="deck in tier.decks | orderBy : 'rank[0]'" class="tier-deck tier-deck-{{deck.deck.playerClass}}">
                            <div class="tier-deck-heading deck-portrait-{{deck.deck.playerClass}}-sm clearfix" role="button" data-toggle="collapse" ng-href="#collapseDeck-{{deck.rank[0]}}" aria-expanded="false" aria-controls="collapseDeck-{{deck.rank[0]}}">
                                <h4>{{deck.name}}</h4>
                                <button class="deck-button" ng-click="goToDeck($event, deck.deck.slug)">VIEW<span class="hidden-xs">&nbsp;DECK</span></button>
                            </div>
                            <div class="tier-deck-body collapse" id="collapseDeck-{{deck.rank[0]}}">
                                <div class="tier-deck-body-inner">
                                    <div class="row tier-deck-body-inner-inner m-l-none m-r-none">

                                        <div class="col-xs-12 col-md-push-4 col-md-8 col-lg-push-3 col-lg-9 m-b-md">
                                            <div class="deck-content">
                                                <h2>EXPLANATION</h2>
                                                <p>{{deck.description}}</p>

                                                <hr class="m-b-lg">

                                                <h2>WEEKLY NOTES</h2>
                                                <p>{{deck.weeklyNotes}}</p>
                                            </div>
                                            <span ng-if="tier.tier < 3">
                                            <hr class="m-b-lg">
                                                <h2 class="m-b-lg">MATCH-UPS<span ng-if="matchupName[deck.deck.id]">&nbsp;- {{matchupName[deck.deck.id]}}</span></h2>
                                                <div class="match-graph m-t-md m-b-md">
                                                    <svg class="graph-wrapper" height="100%" width="100%">
                                                        <text x="1.5%" y="0%" fill="white">100</text>
                                                        <text x="2.5%" y="10%" fill="white">90</text>
                                                        <text x="2.5%" y="20%" fill="white">80</text>
                                                        <text x="2.5%" y="30%" fill="white">70</text>
                                                        <text x="2.5%" y="40%" fill="white">60</text>
                                                        <text x="2.5%" y="50%" fill="white">50</text>
                                                        <text x="2.5%" y="60%" fill="white">40</text>
                                                        <text x="2.5%" y="70%" fill="white">30</text>
                                                        <text x="2.5%" y="80%" fill="white">20</text>
                                                        <text x="2.5%" y="90%" fill="white">10</text>
                                                        <text x="3.5%" y="100%" fill="white">0</text>


                                                        <svg class="pull-right" height="100%" width="95%" x="5%">
                                                            <line x1="0" y1="0%"   x2="100%"  y2="0%" />
                                                            <line x1="0" y1="10%"  x2="100%"  y2="10%" />
                                                            <line x1="0" y1="20%"  x2="100%"  y2="20%" />
                                                            <line x1="0" y1="30%"  x2="100%"  y2="30%" />
                                                            <line x1="0" y1="40%"  x2="100%"  y2="40%" />
                                                            <line x1="0" y1="50%"  x2="100%"  y2="50%" style="stroke:rgba(255,0,0,.3)"/>
                                                            <line x1="0" y1="60%"  x2="100%"  y2="60%" />
                                                            <line x1="0" y1="70%"  x2="100%"  y2="70%" />
                                                            <line x1="0" y1="80%"  x2="100%"  y2="80%" />
                                                            <line x1="0" y1="90%"  x2="100%"  y2="90%" />
                                                            <line x1="0" y1="100%" x2="100%"  y2="100%" />
                                                            <line x1="1.1%" y1="100%" x2="1.1%" y2="0" />

                                                            <svg height="100%" width="98%" x="1.5%">
                                                                <svg class="bar-wrap" ng-repeat="match in filtered = (getMatches(deck.deck._id) | orderBy: 'playerClass')" ng-mouseover="setMouseOver(deck.deck._id, match.against, match.name)" ng-mouseleave="setMouseOver(deck.deck._id, false)" ng-class="{ 'no-mouse' : getMouseOver(deck.deck._id) != false && getMouseOver(deck.deck._id) != match.against }">
                                                                    <rect class="bar bar-{{match.playerClass}}" ng-attr-width="{{(100/filtered.length)-.8}}%" ng-attr-height="{{100-match.chance}}%" ng-attr-x="{{(100/filtered.length)*$index}}%" ng-attr-y="{{match.chance}}%">
                                                                </svg>
                                                                </rect>
                                                            </svg>
                                                        </svg>
                                                    </svg>
                                                </div>
                                            </span>
                                        </div>
                                        
                                        <div class="col-xs-12 col-md-pull-8 col-md-4 col-lg-pull-9 col-lg-3 m-b-md">
                                            <div class="deck-portrait deck-portrait-{{deck.deck.playerClass}} hidden-xs hidden-sm"></div>
                                            <div class="row">
                                                <div class="col-xs-12 col-sm-6 col-md-12 col-lg-12">
                                                    <h3 class="m-b-lg">RANKING</h3>
                                                    <div class="deck-rank m-b-lg">
                                                <div class="{{(deck.rank.current <= deck.rank.last[0] || deck.rank.last[0] == 0) ? 'green-back' : 'red-back'}}">
                                                    <div>
                                                        CURRENT
                                                    </div>
                                                    {{deck.rank[0]}}
                                                </div>
                                                <div class="{{(deck.rank[deck.rank.length - 1] >= deck.rank[0] || deck.rank[deck.rank.length - 1] == 0) ? 'green-back' : 'red-back'}}">
                                                    <div>
                                                        LAST WEEK
                                                    </div>
                                                    <span ng-if="deck.rank[deck.rank.length - 1] != 0 && deck.rank[deck.rank.length - 1] != undefined">{{deck.rank[deck.rank.length - 1]}}</span>
                                                    <span ng-if="deck.rank[deck.rank.length - 1] == 0 || deck.rank[deck.rank.length - 1] == undefined">N/A</span>
                                                </div>
                                                <div class="{{((deck.rank[deck.rank.length - 1] - deck.rank[0]) >= 0 || deck.rank[deck.rank.length - 1] == 0) ? 'green-back' : 'red-back'}}">
                                                    <div>
                                                        CHANGE
                                                    </div>
                                                    <span ng-if="deck.rank[deck.rank.length - 1] != 0 && deck.rank[deck.rank.length - 1] != undefined">{{deck.rank[deck.rank.length - 1] - deck.rank[0]}}</span>
                                                    <span ng-if="deck.rank[deck.rank.length - 1] == 0 || deck.rank[deck.rank.length - 1] == undefined">N/A</span>
                                                </div>
                                            </div>
                                                </div>
                                                <div class="col-xs-12 col-sm-6 col-md-12 col-lg-12">
                                                    <div class="deck-techs" ng-if="deck.tech.length">
                                                        <h3 class="m-b-lg">TECH DECISION</h3>
                                                        <div class="tech" ng-repeat="tech in deck.tech">
                                                            <div class="tech-heading">
                                                                <span ng-if="tech.title">
                                                                    VERSUS {{tech.title}}
                                                                </span>
                                                                <span ng-if="!tech.title">
                                                                    GENERAL
                                                                </span>
                                                            </div>
                                                            <div class="tech-card" ng-repeat="card in tech.cards">
                                                                <div class="tech-card-body" ng-class="{ 'multi' : card.both }" style="background-image: url('{{app.cdn}}cards/{{card.card.photos.small}}')">
                                                                    <div class="pull-left toss" ng-if="!card.toss"><i class="fa fa-plus"></i></div>
                                                                    <div class="pull-left keep" ng-if="card.toss"><i class="fa fa-minus"></i></div>
                                                                    {{card.card.name}}
                                                                </div>
                                                                <div ng-if="card.both" class="both-token">
                                                                    2
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /TIERS -->
            
            <!-- AUTHORS -->
            <div class="row m-l-none m-r-none m-b-md">
                <div class="meta-author col-lg-12" ng-repeat="author in snapshot.authors" >
                    <button class="meta-author-collapser" type="button" data-toggle="collapse" data-target="#{{author.user._id}}" aria-expanded="false" aria-controls="{{author.user._id}}">
                        <div class="author-img-wrapper pull-left hidden-xs">
                            <img ng-if="author.klass.length === 1" class="author-class-icon m-l-sm" ng-src="../../img/meta-snapshot/class-icons/{{author.klass[0]}}.png" />
                            <span ng-if="author.klass.length > 1">
                                <img class="author-class-icon" ng-repeat="ico in author.klass" src="../../img/meta-snapshot/class-icons/{{ico}}.png" style="left: {{((author.klass.length-1)*23)-(23*$index)}}px;" />
                            </span>
                        </div>
                        <div class="author-text-wrapper">
                            <h2 class="m-b-xs" ng-class=" { 'm-t-sm' : author.klass.length > 0 } ">{{author.user.username}}</h2>
                            <span ng-if="author.klass.length === 1">
                                <h3 class="classExpert">{{author.klass[0]}} EXPERT</h3>
                            </span>
                            <h3 ng-if="author.klass.length > 1">
                                <span ng-repeat="klass in author.klass">
                                    <span ng-if="$index > 0">&nbsp;AND</span> {{klass}}
                                </span>
                                EXPERT
                            </h3>
                        </div>
                        <div class="soc-btns pull-right m-r-lg hidden-xs">
                            <a ng-if="author.user.social.twitch" class="btn twitch-btn soc-btn" ng-click="goToTwitch($event, author.user.social.twitch)"><i class="fa fa-twitch"></i></a>
                            <a ng-if="!author.user.social.twitch" class="btn twitch-btn soc-btn disable" disabled><i class="fa fa-twitch"></i></a>
                            <a ng-if="author.user.social.twitter" class="btn twitter-btn soc-btn" ng-click="goToTwitter($event, author.user.social.twitter)"><i class="fa fa-twitter"></i></a>
                            <a ng-if="!author.user.social.twitter" class="btn twitter-btn soc-btn disable" disabled><i class="fa fa-twitter"></i></a>
                        </div>
                    </button>
                    
                    <div class="author-collapse collapse" id="{{author.user._id}}">
                        <p> {{author.description}} </p>
                        <div class="soc-btns m-t-md m-b-md hidden-sm hidden-md hidden-lg">
                            <a ng-if="author.user.social.twitch != '' && author.user.social.twitch != undefined" class="btn twitch-btn soc-btn" ng-click="goToTwitch($event, author.user.social.twitch)"><i class="fa fa-twitch"></i></a>
                            <a ng-if="author.user.social.twitch === '' || author.user.social.twitch === undefined" class="btn twitch-btn soc-btn disable" disabled><i class="fa fa-twitch"></i></a>
                            <a ng-if="author.user.social.twitter != '' && author.user.social.twitter != undefined" class="btn twitter-btn soc-btn" ng-click="goToTwitter($event, author.user.social.twitter)"><i class="fa fa-twitter"></i></a>
                            <a ng-if="author.user.social.twitter === '' || author.user.social.twitter === undefined" class="btn twitter-btn soc-btn disable" disabled><i class="fa fa-twitter"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /AUTHORS -->
            
            
            <!-- comments -->
            <comment-section commentable="snapshot" service="SnapshotService"></comment-section>
            <!-- / commments -->

            
        </div>

    </div>
</div>