<div class="panel panel-danger error-modal animated" ng-show="showError">
    <div class="panel-heading">
        <button type="button" class="close" aria-hidden="true" ng-click="showError = false">&times;</button>
        <strong>Unable to add article</strong>
    </div>
    <div class="panel-body">
        <ul class="error text-danger">
            <li ng-repeat="error in errors">{{error.msg}}</li>
        </ul>
    </div>
</div>
<div class="panel panel-default br-none">
    <form name="form" role="form" class="form-horizontal">
    <div class="panel-heading">
        <h3>Edit a Meta Snapshot</h3>
    </div>
    <div class="panel-body">
        <div class="form-group">
            <label for="title" class="col-sm-2 control-label">Meta Snapshot #</label>
            <div class="col-sm-10 wrapper-none">
                <input class="form-control snap-num" type="text" ng-model="snapshot.snapNum">
            </div>
        </div>
        <div class="form-group">
            <label for="title" class="col-sm-2 control-label">Title</label>
            <div class="col-sm-10 wrapper-none">
                <input id="title" name="title" class="form-control" ng-model="snapshot.title" ng-keyup="setSlug()">
            </div>
        </div>
        <div class="form-group">
            <label for="slug" class="col-sm-2 control-label">URL</label>
            <div class="col-sm-10 wrapper-none">
                <div class="input-group">
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-default" ng-class="{active: snapshot.slug.linked}" ng-click="toggleSlugLink()"><i class="fa" ng-class="{'fa-link': snapshot.slug.linked, 'fa-unlink': !snapshot.slug.linked}"></i></button>
                    </span>
                    <input type="text" id="slug" name="slug" class="form-control" ng-model="snapshot.slug.url" ng-readonly="snapshot.slug.linked" required>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="author" class="col-sm-2 control-label">Authors</label>
            <div class="col-sm-10 wrapper-none">
                <ul class="list-group m-b-md" ng-if="snapshot.authors.length!=0">
                    <li class="list-group-item" ng-repeat="a in snapshot.authors">
                        {{a.username}}<a href="#" class="pull-right" ng-click="removeAuthor(a)"><i class="fa fa-close"></i></a>
                    </li>
                </ul>
                <button class="btn btn-green btn-rounded m-r-sm" ng-click="openAddBox('author')"><i class="fa fa-plus"></i> Add Author</button>
            </div>
        </div>
        <div class="form-group">
            <label for="intro" class="col-sm-2 control-label">Content</label>
            <div class="panel panel-default wrapper-none col-sm-10">
                <div class="panel-body">
                    <label for="intro" class="col-sm-1 control-label">Intro</label>
                    <div class="col-sm-11">
                        <textarea class="form-control m-b-sm" name="intro" ng-model="snapshot.content.intro"></textarea>
                    </div>
                    <label for="thoughts" class="col-sm-1 control-label">Thoughts</label>
                    <div class="col-sm-11">
                        <textarea class="form-control m-b-sm" name="thoughts" ng-model="snapshot.content.thoughts"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="intro" class="col-sm-2 control-label">Tiers</label>
            <div class="col-sm-10 wrapper-none">
                <div class="panel panel-default wrapper-none" ng-repeat="t in snapshot.tiers track by t.tier" ng-if="snapshot.tiers.length != 0">
                    <div class="panel-heading clearfix">
                        <h4 class="panel-title pull-left">
                            <a class="tierHeading" role="button" data-toggle="collapse" href="#collapse{{t.tier}}" aria-expanded="false" aria-controls="collapse{{t.tier}}"><i class="fa fa-caret-down"></i> 
                                Tier {{t.tier}} 
                            </a>
                        </h4>
                        <button class="btn btn-danger btn-sm btn-rounded pull-right" ng-click="removePrompt(t)"><i class="fa fa-close"></i> Remove Tier</button>
                    </div>

                    <div id="collapse{{t.tier}}" class="panel-body collapse wrapper-none"> 
                        <ul class="list-group m-b-none" dnd-list="t.decks">
                            <li class="list-group-item" ng-if="t.decks == 0">There are no decks selected yet!</li>
                            <li class="list-group-item" ng-repeat="d in t.decks" ng-if="t.decks.length != 0">
                                <span class="badge pull-left">{{d.rank.current}}</span>&nbsp;<span dnd-draggable="d" dnd-moved="updateDND(t.decks, $index)" dnd-disable-if="t.decks.length < 2">{{d.deck.name}}</span><span class="pull-right button-block"><button class="m-r-sm" type="button" data-toggle="collapse" data-target="#deckrank{{d.rank.current}}" aria-expanded="false" aria-controls="deckrank{{d.rank.current}}"><i class="fa fa-edit"></i></button><button ng-click="removeDeckPrompt(d.deck)"><i class="fa fa-close"></i></button></span> 
                                <div class="collapse" id="deckrank{{d.rank.current}}">
                                    <div class="form-group wrapper-md">
                                        <div class="clearfix m-b-md">
                                            <label for="deck.explanation" class="control-label col-sm-1">Explanation</label>
                                            <div class="col-sm-9">
                                                <textarea class="form-control" name="explanation" ng-model="d.explanation"></textarea>
                                            </div>
                                        </div>
                                        
                                        <div class="clearfix m-b-md">
                                            <label for="deck.weeklyNotes" class="control-label col-sm-1">Weekly Notes</label>
                                            <div class="col-sm-9">
                                                <textarea class="form-control" name="weeklyNotes" ng-model="d.weeklyNotes"></textarea>
                                            </div>
                                        </div>
                                        
                                        <div class="clearfix m-b-md">
                                            <label for="deck.weeklyTrend" class="control-label col-sm-1">Weekly Trend</label>
                                            <div class="col-sm-9">
                                                <div class="col-sm-1" ng-repeat="trend in trends(trendsLength) track by $index">
                                                    <input class="form-control wrapper-none" type="number" ng-model="d.rank.last[$index]">
                                                    <span># {{snapshot.snapNum - (1+$index)}}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="clearfix">
                                            <div class="col-sm-1">
                                                <label for="deck.tech" class="control-label">Tech Decisions</label>
                                                <a href="#" ng-click="addTech(d,t)"><i class="fa fa-plus m-t-sm"></i> Add Tech</a>
                                            </div>
                                            <div class="col-sm-9">
                                                <div class="col-sm-4" ng-repeat="tech in d.tech">

                                                    
                                                    <div class="panel panel-default">
                                                        <a href="#" class="pull-right m-r-sm" ng-click="removeTech(tech)"><i class="fa fa-close"></i></a>
                                                        <div class="panel-heading">
                                                            <div class="input-group">
                                                                <span class="input-group-addon">vs</span>
                                                                <input type="text" class="form-control" ng-model="tech.title">
                                                            </div>
                                                        </div>
                                                        <ul class="list-group">
                                                            <li ng-class="{cardToss: c.toss, cardKeep: !c.toss}" ng-repeat="c in tech.cards | orderBy : c.card._id" class="list-group-item">
                                                                 <button class="cardBtn" ng-click="( c.toss == false ) ? c.toss = true : c.toss = false"><i class="fa" ng-class="{ 'fa-minus' : c.toss == true, 'fa-plus' : c.toss == false }"></i></button>
                                                                {{c.card.name}}
                                                                <button class="pull-right cardBtn" ng-click="removeTechCard(c)"><i class="fa fa-close"></i></button>
                                                                <button class="pull-right btn btn-small cardBtn" ng-class="{ 'btn-green' : c.both }" ng-click="setBoth(c)">2</button>
                                                            </li>
                                                            <li class="list-group-item">
                                                                <a href="#" ng-click="openAddBox('card', t, d, tech)"><i class="fa fa-plus"></i>&nbsp Add Card</a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <a href="#" ng-click="removeTech(d.t)"><i></i></a>

                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div ng-if="t.tier < 3">
                                            <label class="control-label col-sm-1">Matches</label>
                                            <div class="col-sm-9">
                                                <div class="col-sm-6" ng-repeat="match in getMatches(d.deck._id) track by $index"> 
                                                    <div ng-if="d.deck._id != match.against._id">
                                                        <div class="panel panel-default wrapper-none">
                                                            <div class="panel-heading">
                                                                <p class="m-b-none">{{d.deck.name}} vs</p>
                                                                <p class="m-b-none bold-text ell">{{match.against.name}}</p>
                                                            </div>
                                                            <div class="panel-body">
                                                                <div class="col-sm-12 wrapper-none">
                                                                    <div class="col-sm-10 pull-right">
                                                                        <input ng-change="changeForChance(match)" ng-model="match.forChance" type="range" min="0" max="100" step="5">
                                                                    </div>
                                                                    <div class="col-sm-2 m-t-sm center-text wrapper-none">
                                                                        <p>% {{match.forChance}}</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div ng-if="d.deck._id == match.against._id">
                                                        <div class="panel panel-default wrapper-none">
                                                            <div class="panel-heading">
                                                                <p class="m-b-none">{{d.deck.name}} vs</p>
                                                                <p class="m-b-none bold-text ell">{{match.for.name}}</p>
                                                            </div>
                                                            <div class="panel-body">
                                                                <div class="col-sm-12 wrapper-none">
                                                                    <div class="col-sm-10 pull-right">
                                                                        <input ng-change="changeAgainstChance(match)" ng-model="match.againstChance" type="range" min="0" max="100" step="5">
                                                                    </div>
                                                                    <div class="col-sm-2 m-t-sm center-text wrapper-none">
                                                                        <p>% {{match.againstChance}}</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <a href="#" ng-click="openAddBox('deck', t.tier)"><i class="fa fa-plus"></i> Add deck</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- SECOND PANEL -->
                
                <button ng-click="addTier()" class="btn btn-green btn-rounded"><i class="fa fa-plus"></i> Add Tier</button>
            </div>
        </div>
        
        <div class="form-group">
            <label class="col-sm-2 control-label">Active</label>
            <input ng-model="snapshot.active" type="checkbox">
        </div>
        
    <div class="panel-footer clearfix">
        <div class="col-sm-10 col-sm-offset-2">
            <button type="submit" class="btn btn-blue btn-lg" ng-disabled="form.$invalid" ng-click="editSnapshot()">Edit Meta Snapshot</button>
        </div>
    </div>
    </form>
    </div>
</div>

